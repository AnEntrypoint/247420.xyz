<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://unpkg.com/meshoptimizer@0.18.1/meshopt_decoder.js"></script>
  <script src="./libs/geckos.io-client.2.1.4.min.js"></script>
  
  <script src="dist/full-gltf-model.js"></script>
</head>

<body>
  <script>
    const channel = geckos({ url: "https://rtc.lan.247420.xyz", port: 443 })
    let entities = {};
    channel.onConnect(error => {
      if (error) {
        console.error(error.message)
        return
      }
      channel.on('updates', (updates) => {
        for (let e of Object.keys(entities)) {
          if (!updates.filter((u) => { return u.uuid == e }).length) {
            delete entities[e];
          }
        }
        for (let u of updates) {
          if (entities[u.uuid]) {
            entities[u.uuid].object3D.position.set(u.pos.x, u.pos.y, u.pos.z)
            //entities[u.uuid].object3D.quaternion.set(u.quat.x, u.quat.y, u.quat.z, u.quat.w)
          } else {

            var sceneEl = document.querySelector('#scene');
            var entityEl = document.createElement('a-entity');
            entityEl.setAttribute('full-gltf-model', 'assets/avatar.glb');
            sceneEl.appendChild(entityEl);
            entities[u.uuid] = entityEl;
            window.ent = entityEl;
            window.scene = sceneEl;
            console.log('added')
          }
        }
      })
    })
  </script>
  <a-scene background="color: #FAFAFA">
    <a-entity id="scene" position="3 0 -4">
      <!--a-text position="-1 3 0" color="black" value="schwepe"></a-text-->

      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="-0.5 1 1"></a-entity>
      <a-entity scale="2 2 2" full-gltf-model="url(assets/town.glb)" shadow="cast: true; receive: false"></a-entity>
      <!--a-entity id="ent" full-gltf-model="url(assets/schwepev2.glb)"-->
      <!--/a-entity-->
    </a-entity>
  </a-scene>
</body>

</html>